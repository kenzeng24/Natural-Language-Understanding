# HW 3: The ðŸ¤— Transformers Framework

**Due: March 29, 9:30 AM**

For this assignment, please complete the _problem set_ found in `hw3-pset.ipynb`. The problem set includes coding
problems as well as written problems.

For the coding problems, you will implement functions defined in the Python files `train_model.py`, `test_model.py`, and
`train_job.slurm`, replacing the existing code (which raises a `NotImplementedError`) with your own code. You many
optionally create an additional file called `test_job.slurm`. **Please write all code within the relevant files and
function definitions**; failure to do this may break the rest of your code.

For the written problems, please submit your answers in PDF format, using the filename `hw3-written.pdf`. Make sure to
clearly mark each problem in order to minimize the chances of grading errors.

You do not need to submit anything for Problem 1a.

You are free to use any resources to help you with this assignment, including books or websites. You are also free to
collaborate with any other student or students in this class. However, you must write and submit your own answers to the
problems, and merely copying another student's answer will be considered cheating on the part of both students. If you
choose to collaborate, please list your collaborators at the top of your `hw3-written.pdf` file.

## Setup

You will need to complete your code problems in Python 3, preferably Python 3.8 or later. Apart from the standard Python
libraries, you will need the following dependencies:

* [NumPy](https://numpy.org)
* [tqdm](https://tqdm.github.io/)
* [PyTorch](https://pytorch.org/)
* [ðŸ¤— Datasets](https://huggingface.co/docs/datasets/index)
* [ðŸ¤— Transformers](https://huggingface.co/docs/transformers/index)
* [ðŸ¤— Evaluate](https://huggingface.co/docs/evaluate/index)

These dependencies need to be installed on HPC, and you are encouraged to install them on your personal computer as
well. Please refer to their websites for installation instructions.

## Submission

For your submission, please upload the following files to [Gradescope](https://www.gradescope.com):

* `train_model.py`
* `test_model.py`
* `train_job.slurm`
* `train_with_bitfit.out`
* `train_without_bitfit.out`
* `train_results_with_bitfit.p`
* `train_results_without_bitfit.p`
* `test_results_with_bitfit.p`
* `test_results_without_bitfit.p`
* `hw3-written.pdf`

The `.out` and `.p` files are not provided in this repository; they will be generated by your code when you run it on
HPC. Do not change the names of these files, and do not upload any other files to Gradescope. Failure to follow the
submission instructions may result in a penalty of up to 5 points.

## Grading

The point values for each problem are given below. 

| Problem | Problem Type | Points |
|---|---|---|
| 1b: Understand BERT Inputs | Written | 10 |
| 1c: Understand BERT Hyperparameters | Written | 10 |
| 1d: Prepare Dataset | Code | 10 |
| 1e: Freeze Non-Bias Weights | Code | 10 |
| 1f: Set Up Trainer and Tester | Code | 15 |
| 1g: Set Up Hyperparameter Tuning | Code | 15 |
| 2a: Prepare Slurm Batch Job | Code | 10 |
| 2b: Train Models | Code and Written | 10 |
| 2c: Test Models and Report Results | Code and Written | 10 |
| **Total** | | **100** |

### Rubric for Code Problems

Code questions for Problem 1 will be graded using a series of [Python unit tests](https://realpython.com/python-testing/). Each
function you implement will be tested on a number of randomly generated inputs, which will match the specifications
described in the function docstrings. **The unit tests will run immediately upon submitting your solution to
[Gradescope](https://www.gradescope.com), and you will be able to see the results as soon as the tests have finished
running.** Therefore, you are encouraged to debug and resubmit your code if one or more unit tests fail.

For code questions, you will receive:

* full points if your code runs and passes all test cases
* at least 5 points if your code runs but fails at least one test case
* 0 points if your code does not run.

Partial credit may be awarded at the TAs' discretion, depending on the correctness of your logic and the severity of
bugs or other mistakes in your code. All code problems will be graded **as if all other code problems had been answered
correctly**. Therefore, an incorrect implementation of one function should (in theory) not affect your grade on other
problems that depend on that function.

Code questions for Problem 2 will be graded via a combination of automated tests and manual inspection. Unit tests 
may or may not be available at submission time.

### Rubric for Written Problems

For written problems, you will receive:

* full points if results are reported accurately and are accompanied by at least 1 to 2 sentences of thoughtful analysis
* at least 2 points if a good-faith effort (according to the TAs' judgement) has been made to answer the question
* 0 points if your answer is blank.

Partial credit may be awarded at the TAs' discretion.

## Late Submissions and Resubmissions

Grading will commence on April 5, 2023, and solutions will be released on that day. Therefore, no late submissions will
be accepted after 9:30 AM on April 5. You may resubmit your solutions as many times as you like; only the final
submission will be graded. If the final submission occurs after the deadline on March 29, then your submission will be
considered late even if you have previously submitted your solution before the deadline.